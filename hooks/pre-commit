#!/bin/bash
# Pre-commit hook to validate EditorConfig rules

# Get the directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

# Change to the repository root
cd "$ROOT_DIR"

# Check if Python is available
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python 3 is required but not found"
    exit 1
fi

# Check if validator script exists
if [ ! -f "hooks/validate_editorconfig.py" ]; then
    echo "‚ùå hooks/validate_editorconfig.py not found"
    exit 1
fi

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if [ -z "$STAGED_FILES" ]; then
    echo "‚úÖ No staged files to validate"
    exit 0
fi

echo "üîç Validating EditorConfig rules for staged files..."

# Run validator on staged files
python3 hooks/validate_editorconfig.py $STAGED_FILES

# Check exit code
if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå EditorConfig validation failed!"
    echo "Please fix the issues above or use 'git commit --no-verify' to bypass."
    exit 1
fi

echo "‚úÖ All staged files comply with EditorConfig rules"
exit 0
