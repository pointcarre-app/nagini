#!/bin/bash
# Pre-commit hook to run all validation steps.

# 1. Validate EditorConfig rules
echo "üîç Validating EditorConfig rules..."
VALIDATOR_SCRIPT="$(git rev-parse --show-toplevel)/hooks/validate_editorconfig.py"
if ! python3 "$VALIDATOR_SCRIPT"; then
    echo "‚ùå EditorConfig validation failed. Aborting commit."
    exit 1
fi
echo "‚úÖ EditorConfig validation passed."

# 2. Run Scenery tests
echo -e "\nüêç Running Scenery test suite..."
SCENERY_DIR="$(git rev-parse --show-toplevel)/scenery"
cd "$SCENERY_DIR"

# Activate virtual environment
source env/bin/activate

# Run tests
if ! python run_tests.py; then
    echo "‚ùå Scenery tests failed. Aborting commit."
    exit 1
fi

echo "‚úÖ Scenery tests passed."
exit 0
